<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tasheer DMI â€“ Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap + your main styles -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />

  <!-- Chart.js for graphs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body onload="initAdminPage()">
  <div class="container-fluid">
    <!-- Top bar -->
    <div class="row py-3 border-bottom bg-white shadow-sm">
      <div class="col-6 d-flex align-items-center">
        <h1 class="h5 mb-0 text-primary">Tasheer DMI â€“ Admin Dashboard</h1>
      </div>
      <div class="col-6 d-flex justify-content-end align-items-center gap-2">
        <span class="text-muted small">Admin View</span>
        <button class="btn btn-sm btn-outline-secondary" onclick="logout()">Logout</button>
      </div>
    </div>

    <div class="row g-0">
      <!-- Sidebar with departments -->
      <nav id="adminSidebar"
           class="col-md-3 col-lg-2 d-md-block bg-light border-end admin-sidebar">
        <div class="p-3">
          <h6 class="text-uppercase text-muted small mb-3">Departments</h6>
          <div id="adminDeptList" class="nav flex-column nav-pills gap-1">
            <!-- Filled by initAdminPage() -->
          </div>
        </div>
      </nav>

      <!-- Main dashboard area -->
      <main class="col-md-9 ms-sm-auto col-lg-10 px-4 py-4">
        <!-- Header for selected department -->
        <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
          <div>
            <h2 id="adminDeptTitle" class="h4 mb-1">Select a department</h2>
            <p id="adminDeptSubtitle" class="text-muted mb-0">
              Overview of DMI scores and questionnaire completion.
            </p>
          </div>
        </div>

        <!-- KPI cards row -->
        <div class="row g-3 mb-4">
          <div class="col-md-3">
            <div class="card h-100 shadow-sm">
              <div class="card-body">
                <h6 class="text-muted mb-2">Overall Maturity</h6>
                <div id="adminOverallPercent" class="display-6 fw-semibold text-primary">â€“</div>
                <small class="text-muted">Percentage of maximum possible score</small>
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="card h-100 shadow-sm">
              <div class="card-body">
                <h6 class="text-muted mb-2">Questions Completed</h6>
                <div id="adminQuestionsCard" class="h3 mb-0 fw-semibold">â€“</div>
                <small class="text-muted">Answered / Total questions</small>
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="card h-100 shadow-sm">
              <div class="card-body">
                <h6 class="text-muted mb-2">Maturity Band</h6>
                <div id="adminBandName" class="h5 mb-1 text-primary">â€“</div>
                <small id="adminBandDesc" class="text-muted d-block">Select a department to view band.</small>
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="card h-100 shadow-sm">
              <div class="card-body">
                <h6 class="text-muted mb-2">Data Status</h6>
                <div id="adminDataStatus" class="h6 mb-1">No data</div>
                <small class="text-muted">Based on stored responses in this browser.</small>
              </div>
            </div>
          </div>
        </div>

        <!-- Chart + area list -->
        <div class="row g-4">
          <div class="col-lg-7">
            <div class="card h-100 shadow-sm">
              <div class="card-header bg-white border-0">
                <h6 class="mb-0">Area Breakdown</h6>
              </div>
              <div class="card-body">
                <canvas id="adminAreaChart" style="min-height:260px"></canvas>
              </div>
            </div>
          </div>

          <div class="col-lg-5">
            <div class="card h-100 shadow-sm">
              <div class="card-header bg-white border-0">
                <h6 class="mb-0">Areas Summary</h6>
              </div>
              <div class="card-body">
                <ul id="adminAreaList" class="list-group list-group-flush small">
                  <!-- Filled in JS -->
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Bottom actions -->
        <div class="d-flex justify-content-end gap-2 mt-4">
          <button class="btn btn-outline-secondary btn-sm" onclick="exportAllReportsToExcel()">
            ðŸ“Š Export All Department Reports
          </button>
        </div>
      </main>
    </div>
  </div>

  <!-- XLSX (needed for exportAllReportsToExcel) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <!-- Core data + logic (order matters: bands â†’ quizzes â†’ logic) -->
  <script src="maturitybands.js"></script>

  <!-- Include all department quiz files so DMI_QUESTION_SETS is populated -->
  <script src="quiz_data_analytics.js"></script>
  <script src="quiz_procurement.js"></script>
  <script src="quiz_sap_ERP.js"></script>
  <script src="quiz_solution_delivery.js"></script>
  <script src="quiz_branches_ops.js"></script>
  <script src="quiz_corporate_IT.js"></script>

  <!-- Users (if you need it) + shared logic -->
  <script src="users.js"></script>
  <script src="logic.js"></script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
